@{
    ViewBag.Title = "LayoutWizardView";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section script
{

    <script type="text/javascript" src="../../../../Scripts/ngcommon.js"></script>
    <script type='text/javascript' src='../../../../Scripts/LggControl.js'></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/LayoutSetting.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/ToolbarZoneSetting.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/HeadAndBodySelect.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/TreeZoneSetting.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/QueryZoneSetting.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/HeadZoneSetting.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Wizard/BodyZoneSetting.js"></script>
    <script type="text/javascript">
        var isLoad = false;

        var transferData = Ext.JSON.decode(Ext.htmlDecode('@ViewBag.TransferData'));
        var namespace = getQueryStringByName("namespace");

        Ext.onReady(function () {

            var cardView = Ext.create('Ext.panel.Panel', {
                id: 'cardView',
                title: '界面布局向导',
                layout: 'card',
                bodyStyle: 'padding:15px',
                region: 'center',
                defaults: {
                    // applied to each contained panel
                    border: false
                },
                // just an example of one possible navigation scheme, using buttons
                bbar: [
                    {
                        id: 'move-prev',
                        text: '上一步',
                        handler: function (btn) {
                            navigate(btn.up("panel"), "prev");
                        },
                        disabled: true
                    },
                    '->', // greedy spacer so that the buttons are aligned to each side
                    {
                        id: 'move-next',
                        text: '下一步',
                        handler: function (btn) {
                            navigate(btn.up("panel"), "next");
                        }
                    }
                ],
                // the panels (or "cards") within the layout
                items: [layoutSettingViewPanel, headAndBodySelectMainViewPanel, headZoneMainViewPanel, bodyZoneMainViewPanel],
                renderTo: Ext.getBody()
            });

            var navigate = function (panel, direction) {
                // This routine could contain business logic required to manage the navigation steps.
                // It would call setActiveItem as needed, manage navigation button state, handle any
                // branching logic that might be required, handle alternate actions like cancellation
                // or finalization, etc.  A complete wizard implementation could get pretty
                // sophisticated depending on the complexity required, and should probably be
                // done as a subclass of CardLayout in a real-world implementation.
                
                if (panel.title == '界面布局向导') {
                    
                }
                else if (panel.title == '表头表体选择') {
                    collectHeadAndBodyData();
                    loadHeadZoneSettingData();
                }
                else if (panel.title == '表头设置') {
                    collectHeadZoneData();
                    loadBodyZoneData();
                }
                else if (panel.title == '表体设置') {
                    debugger 
                    collectBodyZoneData();
                    window.close();
                }
                    
                
                

                var layout = panel.getLayout();
                layout[direction]();
                Ext.getCmp('move-prev').setDisabled(!layout.getPrev());
                if (!layout.getNext()) {
                    Ext.getCmp('move-next').setText('完成');
                    //Ext.getCmp('move-next').setDisabled(true);
                } else {
                    Ext.getCmp('move-next').setDisabled(false);
                    Ext.getCmp('move-next').setText('下一步');

                }

                if (!layoutSettingViewPanel.hidden) {
                    cardView.setTitle('界面布局向导');
                }
                    //else if (!toolbarZoneSettingViewPanel.hidden) {
                    //    cardView.setTitle('工具栏向导');
                    //}
                else if (!headAndBodySelectMainViewPanel.hidden) {
                    cardView.setTitle('表头表体选择');
                }
                    //else if (!queryZoneViewPanel.hidden) {
                    //    cardView.setTitle('查询字段设置');
                    //}
                else if (!headZoneMainViewPanel.hidden) {
                    cardView.setTitle('表头设置');
                }
                else if (!bodyZoneMainViewPanel.hidden) {
                    cardView.setTitle('表体设置');
                }
            };

            new Ext.Viewport(
                {
                    id: "viewPort",
                    layout: 'border',
                    items:
                    [
                        cardView
                    ]
                });

        });

    </script>

}
